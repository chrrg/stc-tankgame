C51 COMPILER V9.54   OS_CPU_C                                                              07/03/2020 23:28:51 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE OS_CPU_C
OBJECT MODULE PLACED IN .\OutPut\OS_CPU_C.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE uCosii\OS_CPU_C.C LARGE OPTIMIZE(8,SIZE) BROWSE DEBUG OBJECTEXTEND PRINT
                    -(.\OutPut\OS_CPU_C.lst) TABS(2) OBJECT(.\OutPut\OS_CPU_C.obj)

line level    source

   1          /*
   2          *********************************************************************************************************
   3          *                                               uC/OS-II
   4          *                                               ÊµÊ±ÄÚºË
   5          *
   6          *                        (c) Copyright 1992-1998, Jean J. Labrosse, Plantation, FL
   7          *                                               °æÈ¨ËùÓĞ
   8          *
   9          *                                            MCU-51 ×¨ÓÃ´úÂë
  10          *                                           KEIL C51´óÄ£Ê½±àÒë
  11          *
  12          * ÎÄ¼şÃû : OS_CPU_C.C
  13          * ×÷Õß   : Jean J. Labrosse
  14          *********************************************************************************************************
  15          */
  16          
  17          #define  OS_CPU_GLOBALS
  18          #include "source\includes.h"
  19          
  20          /*
  21          *********************************************************************************************************
  22          *                                        ³õÊ¼»¯ÈÎÎñ¶ÑÕ»
  23          *
  24          * ÃèÊö       : Õâ¸öº¯Êı±»OSTaskCreate()»òOSTaskCreateExt()µ÷ÓÃ£¬ÒÔ±ã³õÊ¼»¯ĞÂ´´½¨ÈÎÎñµÄ¶ÑÕ»½á¹¹¡£±¾º¯Êı
  25          *              Óë´¦ÀíÆ÷¸ß¶ÈÏà¹Ø¡£
  26          *
  27          * ²ÎÊı       : task          Ö¸ÏòÈÎÎñ´úÂëµÄÖ¸Õë
  28          *
  29          *              pdata         µ±ÈÎÎñµÚÒ»´ÎÖ´ĞĞÊ±½«Òª´«ÈëÈÎÎñµÄÓÃ»§Êı¾İ½á¹¹Ö¸Õë
  30          *
  31          *              ptos          Õ»¶¥Ö¸Õë¡£ptosÖ¸Õë±»Ä¬ÈÏÎªÓÃ»§¶ÑÕ»Èë¿ÚÖ¸Õë¡£Èç¹ûOS_STK_GROWTH±»ÖÃ1£¬ÄÇÃ´£¬
  32          *                            ptosÖ¸ÏòÓÃ»§¶ÑÕ»µÄ×î¸ßÓĞĞ§µØÖ·¡£Í¬ÑùµØ£¬Èç¹ûOS_STK_GROWTHÇå0£¬ptos½«Ö¸Ïò
  33          *                            ÓÃ»§¶ÑÕ»µÄ×îµÍÓĞĞ§µØÖ·¡£
  34          *
  35          *              opt           Ö¸¶¨¿ÉÒÔ¸Ä±äOSTaskStkInit()ĞĞÎªµÄÑ¡Ïî¡£(¼ûuCOS_II.H for OS_TASK_OPT_???)¡£
  36          *
  37          * ·µ»ØÖµ     : ÎÒĞŞ¸ÄÁËÔ­À´µÄ³ÌĞò£¬Ê¹º¯Êı×ÜÊÇ·µ»ØÓÃ»§¶ÑÕ»¿Õ¼äµÄ×îµÍÓĞĞ§µØÖ·¡£ÕâÑùĞŞ¸ÄÌá¸ßÁËTCB»»Èë»»³ö
  38          *              µÄĞ§ÂÊ¡£
  39          *
  40          * ×¢Òâ       : ÈÎÎñ¶ÑÕ»½á¹¹:
  41          *
  42          *                                    ---------- -
  43          *                 ÓÃ»§Õ»×î¸ßµØÖ·---->|        | |
  44          *                                    ---------- |
  45          *                                    |   ...  | ·ÂÕæ¶ÑÕ»¿Õ¼ä
  46          *----------                          ---------- | Ã¿ÈÎÎñÒ»¸ö
  47          *|OSTCBCur|               ?C_XBP---->|        | | KEIL×Ô¶¯´¦Àí
  48          *----------                          ---------- -
  49          *    |                               |¿ÕÏĞ¼ä¸ô|
  50          *    |     -----------------------   ----------                           ----------
  51          *    \---->|OSTCBCur->OSTCBStkPtr|   |?C_XBPµÍ|                    SP---->|        |
  52          *          -----------------------   ----------                           ----------
  53          *                     |              |?C_XBP¸ß|                           |        |
  54          *                     |              ---------- -                         ----------
C51 COMPILER V9.54   OS_CPU_C                                                              07/03/2020 23:28:51 PAGE 2   

  55          *                     |              |        | |                         |   .    |
  56          *                     |              ---------- |                         |   .    |
  57          *                     |              |        | |                         |   .    |
  58          *                     |              ---------- |                         ----------
  59          *                     |              |   .    |³¤¶È                       |        | +1
  60          *                     |              |   .    | |                         ----------
  61          *                     |              |   .    | |             OSStack---->|        | 0
  62          *                     |              ---------- |                         ----------
  63          *                     |              |        | |          OSStkStart---->| ²»¹ØĞÄ | -1  µÍµØÖ·
  64          *                     |              ---------- -                         ----------
  65          *                     \------------->|  ³¤¶È  | µÍµØÖ·                   ÏµÍ³Ó²¼ş¶ÑÕ»
  66          *                                    ----------
  67          *                                     ÓÃ»§¶ÑÕ»                       ³¤¶È=SP-OSStkStart
  68          *********************************************************************************************************
  69          */
  70          
  71          OS_STK *OSTaskStkInit (void (*task)(void *pd) reentrant, void *ppdata, OS_STK *ptos, INT16U opt) reentrant
  72          {    
  73   1          OS_STK *stk;
  74   1      
  75   1          ppdata = ppdata;
  76   1          opt    = opt;                               //optÃ»±»ÓÃµ½£¬±£Áô´ËÓï¾ä·ÀÖ¹¸æ¾¯²úÉú    
  77   1          stk    = ptos;                              //ÓÃ»§¶ÑÕ»×îµÍÓĞĞ§µØÖ·
  78   1          *stk++ = 15;                                //ÓÃ»§¶ÑÕ»³¤¶È  15 
  79   1          *stk++ = (INT16U)task & 0xFF;               //ÈÎÎñµØÖ·µÍ8Î» (1)
  80   1          *stk++ = (INT16U)task >> 8;                 //ÈÎÎñµØÖ·¸ß8Î» (2)   
  81   1          *stk++ = 0x0A;                              //ACC     (3)
  82   1          *stk++ = 0x0B;                              //B       (4)
  83   1          *stk++ = 0x00;                              //DPH     (5)
  84   1          *stk++ = 0x00;                              //DPL     (6)
  85   1          *stk++ = 0x00;                              //PSW     (7)
  86   1          *stk++ = 0x00;                              //R0      (8)
  87   1          
  88   1        //R3¡¢R2¡¢R1ÓÃÓÚ´«µİÈÎÎñ²ÎÊıppdata£¬ÆäÖĞR3´ú±í´æ´¢Æ÷ÀàĞÍ£¬R2Îª¸ß×Ö½ÚÆ«ÒÆ£¬R1ÎªµÍ×Ö½ÚÎ»ÒÆ¡£
  89   1        //Í¨¹ı·ÖÎöKEIL»ã±à£¬ÁË½âµ½ÈÎÎñµÄvoid *ppdata²ÎÊıÇ¡ºÃÊÇÓÃR3¡¢R2¡¢R1´«µİ£¬²»ÊÇÍ¨¹ıĞéÄâ¶ÑÕ»¡£
  90   1          *stk++ = (INT16U)ppdata & 0xFF;             //R1      (9)
  91   1          *stk++ = (INT16U)ppdata >> 8;               //R2      (10)
  92   1          *stk++ = 0x01;                              //R3  (11) XDATA£¬ËùÒÔ´æ´¢Æ÷ÀàĞÍ¹Ì¶¨Îª1£¬¼ûC51.PDFµÚ178Ò³Ë
             -µÃ÷¡£
  93   1      
  94   1          *stk++ = 0x04;                              //R4      (12)
  95   1          *stk++ = 0x05;                              //R5      (13)
  96   1          *stk++ = 0x06;                              //R6      (14)
  97   1          *stk++ = 0x07;                              //R7      (15)
  98   1                                                      //²»ÓÃ±£´æSP£¬ÈÎÎñÇĞ»»Ê±¸ù¾İÓÃ»§¶ÑÕ»³¤¶È¼ÆËãµÃ³ö¡£    
  99   1          *stk++ = (INT16U) (ptos+MaxStkSize) >> 8;   //?C_XBP ·ÂÕæ¶ÑÕ»Ö¸Õë¸ß8Î»
 100   1          *stk++ = (INT16U) (ptos+MaxStkSize) & 0xFF; //?C_XBP ·ÂÕæ¶ÑÕ»Ö¸ÕëµÍ8Î»
 101   1              
 102   1          return ((void *)ptos);
 103   1      }
 104          
 105          #if OS_CPU_HOOKS_EN
 106          
 107          /*
 108          *********************************************************************************************************
 109          *                                       OS INITIALIZATION HOOK
 110          *                                            (BEGINNING)
 111          *
 112          * Description: This function is called by OSInit() at the beginning of OSInit().
 113          *
 114          * Arguments  : none
 115          *
C51 COMPILER V9.54   OS_CPU_C                                                              07/03/2020 23:28:51 PAGE 3   

 116          * Note(s)    : 1) Interrupts should be disabled during this call.
 117          *********************************************************************************************************
 118          */
 119          #if OS_VERSION > 203
 120          void OSInitHookBegin (void) reentrant
 121          {
 122   1      
 123   1      }
 124          #endif
 125          
 126          /*
 127          *********************************************************************************************************
 128          *                                       OS INITIALIZATION HOOK
 129          *                                               (END)
 130          *
 131          * Description: This function is called by OSInit() at the end of OSInit().
 132          *
 133          * Arguments  : none
 134          *
 135          * Note(s)    : 1) Interrupts should be disabled during this call.
 136          *********************************************************************************************************
 137          */
 138          #if OS_VERSION > 203
 139          void OSInitHookEnd (void) reentrant
 140          {
 141   1      }
 142          #endif
 143          
 144          /*
 145          *********************************************************************************************************
 146          *                                          ÈÎÎñ´´½¨¹³¹Òº¯Êı
 147          *
 148          * ÃèÊö       : ÈÎÎñ´´½¨Ê±µ÷ÓÃ
 149          *
 150          * ²ÎÊı       : ptcbÊÇÖ¸Ïò½«±»´´½¨ÈÎÎñµÄÈÎÎñ¿ØÖÆ¿éµÄÖ¸Õë¡£
 151          *
 152          * ×¢Òâ       : 1) µ÷ÓÃÆÚ¼äÖĞ¶Ï±»½ûÖ¹
 153          *********************************************************************************************************
 154          */
 155          void OSTaskCreateHook (OS_TCB *ptcb) reentrant
 156          {
 157   1          ptcb = ptcb;                       /* Prevent compiler warning                                     */
 158   1      }
 159          
 160          
 161          /*
 162          *********************************************************************************************************
 163          *                                          ÈÎÎñÉ¾³ı¹³¹Òº¯Êı
 164          *
 165          * ÃèÊö       : ÈÎÎñÉ¾³ıÊ±µ÷ÓÃ
 166          *
 167          * ²ÎÊı       : ptcbÊÇÖ¸Ïò½«±»É¾³ıÈÎÎñµÄÈÎÎñ¿ØÖÆ¿éµÄÖ¸Õë¡£
 168          *
 169          * ×¢Òâ       : 1) µ÷ÓÃÆÚ¼äÖĞ¶Ï±»½ûÖ¹
 170          *********************************************************************************************************
 171          */
 172          #if OS_TASK_DEL_EN > 0
              void OSTaskDelHook (OS_TCB *ptcb) reentrant
              {
                  ptcb = ptcb;                       /* Prevent compiler warning                                     */
              }
              #endif
C51 COMPILER V9.54   OS_CPU_C                                                              07/03/2020 23:28:51 PAGE 4   

 178          
 179          /*
 180          *********************************************************************************************************
 181          *                                          ÈÎÎñÇĞ»»¹³¹Òº¯Êı
 182          *
 183          * ÃèÊö       : Ö´ĞĞÈÎÎñÇĞ»»Ê±µ÷ÓÃ¡£ÕâÔÊĞíÄãÔÚÉÏÏÂÎÄÇĞ»»ÆÚ¼äÖ´ĞĞÆäËü²Ù×÷¡£
 184          *
 185          * ²ÎÊı       : ÎŞ
 186          *
 187          * ×¢Òâ       : 1) µ÷ÓÃÆÚ¼äÖĞ¶Ï±»½ûÖ¹
 188          *              2) ¼Ù¶¨È«¾ÖÖ¸Õë'OSTCBHighRdy'ÒÑ¾­Ö¸ÏòÁË½«Òª±»»»ÈëµÄÈÎÎñ¿ØÖÆ¿é(¼´:×î¸ßÓÅÏÈ¼¶ÈÎÎñ)£¬²¢ÇÒ
 189          *                 'OSTCBCur'Ö¸ÏòÁË½«±»»»³öµÄÈÎÎñ(¼´:µ±Ç°ÈÎÎñ)¡£
 190          *********************************************************************************************************
 191          */
 192          void OSTaskSwHook (void) reentrant
 193          {
 194   1      }
 195          
 196          /*
 197          *********************************************************************************************************
 198          *                                          Í³¼ÆÈÎÎñ¹³¹Òº¯Êı
 199          *
 200          * ÃèÊö       : Õâ¸öº¯ÊıÃ¿ÃëÖÓ±»uC/OS-IIÍ³¼ÆÈÎÎñµ÷ÓÃ¡£ÕâÃ´×öÊ¹ÄãµÄÓ¦ÓÃ³ÌĞò¿ÉÒÔÔö¼ÓÍ³¼ÆÈÎÎñµÄ¹¦ÄÜ¡£
 201          *
 202          * ×¢Òâ       : ÎŞ
 203          *********************************************************************************************************
 204          */
 205          #if OS_TASK_STAT_EN > 0
              void OSTaskStatHook (void) reentrant
              {
              }
              #endif
 210          
 211          /*
 212          *********************************************************************************************************
 213          *                                           OSTCBInit() HOOK
 214          *
 215          * Description: This function is called by OSTCBInit() after setting up most of the TCB.
 216          *
 217          * Arguments  : ptcb    is a pointer to the TCB of the task being created.
 218          *
 219          * Note(s)    : 1) Interrupts may or may not be ENABLED during this call.
 220          *********************************************************************************************************
 221          */
 222          #if OS_VERSION > 203
 223          void OSTCBInitHook (OS_TCB *ptcb) reentrant
 224          {
 225   1          ptcb = ptcb;                                           /* Prevent Compiler warning                 */
 226   1      }
 227          #endif
 228          
 229          /*
 230          *********************************************************************************************************
 231          *                                          ¶¨Ê±¹³¹Òº¯Êı
 232          *
 233          * ÃèÊö       : ±¾º¯ÊıÃ¿Ò»µÎ´ğ±»µ÷ÓÃÒ»´Î¡£
 234          *
 235          * ²ÎÊı       : ÎŞ
 236          *
 237          * ×¢Òâ       : 1) ÔÚ±¾µ÷ÓÃÆÚ¼äÖĞ¶Ï¿ÉÒÔ»ò²»¿ÉÒÔÊ¹ÄÜ¡£
 238          *********************************************************************************************************
 239          */
C51 COMPILER V9.54   OS_CPU_C                                                              07/03/2020 23:28:51 PAGE 5   

 240          void OSTimeTickHook (void) reentrant
 241          {
 242   1      }
 243          
 244          /*
 245          *********************************************************************************************************
 246          *                                             IDLE TASK HOOK
 247          *
 248          * Description: This function is called by the idle task.  This hook has been added to allow you to do  
 249          *              such things as STOP the CPU to conserve power.
 250          *
 251          * Arguments  : none
 252          *
 253          * Note(s)    : 1) Interrupts are enabled during this call.
 254          *********************************************************************************************************
 255          */
 256          #if OS_VERSION >= 251
 257          void OSTaskIdleHook (void) reentrant
 258          {
 259   1      }
 260          #endif
 261          
 262          #endif
 263          
 264          /*
 265             Ê¹ÓÃCÓïÑÔµÄÖĞ¶Ï´¦Àíº¯ÊıÓĞÖúÓëÌá¸ß³ÌĞòµÄÒÆÖ²ĞÔ¡£½¨ÒéÖĞ¶Ï³ÌĞò²»ÒªÌ«³¤£¬Èç¹û³¤ÔòÊ¹ÓÃĞÅºÅÁ¿À´ÓëÈÎÎñÍ¬²½£¬
 266             ÔÚÍâ²¿ÈÎÎñÖĞÊµÏÖ´óÁ¿µÄ´¦Àí¡£
 267             ÖĞ¶Ï´¦ÀíÀı³Ì¶¼·ÅÔÚÏÂÃæ¡£
 268          */
 269          
 270          /*
 271          void UserTickTimer(void)
 272          {
 273              TH0=0xB8;       //ÆÕÍ¨51¶¨Ê±Æ÷·½Ê½1£¬±ØĞëÔÚ·¢ÉúÖĞ¶ÏÊ±£¬ÖØĞÂ¸³Öµ²¢ÔÙ´ÎÆô¶¯¼ÆÊ±
 274              TL0=0;              //Tick=50´Î/Ãë(¼´0.02Ãë/´Î)£¬¾§Õñ11.0592M
 275              TR0=1;
 276          }
 277           
 278          //uCOS-IIÏµÍ³Ê±ÖÓÖĞ¶Ï´¦Àí³ÌĞò
 279          void OSTickISR(void) interrupt 1
 280          {
 281              OSIntEnter();         // Must be called first at every hardware interrupt entry point 
 282              UserTickTimer();        // User functions can be called here.
 283              OSTimeTick();         // Must be called during tick isr 
 284              OSIntExit();          // Must be called finally at every hardware interupt exit point 
 285          }
 286          */
 287          /*
 288            ÉèÖÃÓ²¼ş¼Ä´æÆ÷µÄ³õÊ¼Öµ¡£
 289            ³õÊ¼»¯¶¨Ê±Æ÷0,×÷ÎªucOS-IIµÄÏµÍ³Ê±ÖÓ¡£
 290            »¹ÓĞÆäËûµÄÓëÓ²¼şÏà¹ØµÄ³õÊ¼»¯Ò²¿ÉÒÔ·ÅÔÚÕâÀï¡£
 291          */


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    547    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
C51 COMPILER V9.54   OS_CPU_C                                                              07/03/2020 23:28:51 PAGE 6   

END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
